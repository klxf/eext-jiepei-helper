<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>关于软件</title>
	<link rel="stylesheet" href="/iframe/css/index.css">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="min-h-screen bg-gray-100 flex items-center justify-center">
	<div class="bg-white p-4 rounded-lg w-[400px] h-[200px] flex flex-col justify-between items-center text-center">
		<div>
			<h1 class="text-2xl font-bold text-gray-800 mb-2" id="name"></h1>
			<p class="text-[12px] text-gray-600" id="description"></p>
			<p class="text-gray-600 text-sm" id="version"></p>
			<p class="text-gray-600 text-sm" id="tip"></p>
		</div>

		<div class="flex justify-center space-x-4 mt-auto">
			<a id="home" class="text-blue-600 hover:text-blue-800 text-sm transition duration-300 ease-in-out">
				🏠 扩展主页
			</a>
			<a id="bugs" class="text-blue-600 hover:text-blue-800 text-sm transition duration-300 ease-in-out">
				🐞 Bug反馈
			</a>
			<a id="check" class="text-blue-600 hover:text-blue-800 text-sm transition duration-300 ease-in-out">
				✨ 检查更新
			</a>
		</div>

		<div class="flex justify-center text-[12px] text-gray-500 mt-2">
			本扩展使用 Apache-2.0 许可协议开源
		</div>
	</div>
</div>
<script>
	// 页面加载完成
	document.addEventListener('DOMContentLoaded', async function () {
		const file = await eda.sys_FileSystem.getExtensionFile("/extension.json");
		if (file) {
			const extensionData = JSON.parse(await file.text());
			document.getElementById('name').textContent = extensionData.displayName;
			document.getElementById('description').textContent = extensionData.description;
			document.getElementById('version').textContent = `V${extensionData.version}`;
			document.getElementById('home').setAttribute('href', extensionData.homepage);
			document.getElementById('bugs').setAttribute('href', extensionData.bugs);
		}
	});

	document.addEventListener('click', function (event) {
		if (event.target.tagName.toLowerCase() === 'a') {
			event.preventDefault();
			const url = event.target.getAttribute('href');
			if (url) {
				eda.sys_Window.open(url);
			}
		}
	});

	document.getElementById('check').addEventListener('click', function (event) {
		event.preventDefault();
		eda.sys_ClientUrl.request("https://extensions.oshwhub.com/api/v1/extensions/his_version_list?bizKey=188546598067642368", "GET")
			.then(response => response.json())
			.then(data => {
				if (data && data.code === 0) {
					const his_list = data.result.list;
					const latestVersion = his_list[0].version;
					const currentVersion = document.getElementById('version').textContent.replace('V', '');
					// 比较版本号，latestVersion 和 currentVersion
					const latestParts = latestVersion.split('.').map(Number);
					const currentParts = currentVersion.split('.').map(Number);
					let isNewVersionAvailable = false;
					for (let i = 0; i < Math.max(latestParts.length, currentParts.length); i++) {
						const latestPart = latestParts[i] || 0;
						const currentPart = currentParts[i] || 0;
						if (latestPart > currentPart) {
							isNewVersionAvailable = true;
							break;
						} else if (latestPart < currentPart) {
							break;
						}
					}
					if (isNewVersionAvailable) {
						eda.sys_Message.showToastMessage(`😋 有新版本可用: V${latestVersion}`, 'info');
						document.getElementById('tip').innerHTML = `<a href="https://extensions.oshwhub.com/item/fangs233/jiepei-helper" target="_blank" class="text-blue-600 hover:text-blue-800">前往更新新版本</a>`;
					} else {
						eda.sys_Message.showToastMessage("👍 当前已是最新版本", 'success');
					}
				} else {
					eda.sys_Message.showToastMessage("🥺 获取版本信息失败", 'error');
				}
			});
	})
</script>
</body>
</html>
